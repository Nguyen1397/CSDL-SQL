CREATE DATABASE HoaDon
GO

USE HoaDon
GO

CREATE TABLE Kho
(
	ID_SP VARCHAR(5) PRIMARY KEY,
	TenSP NVARCHAR(40),
	MoTa NVARCHAR(40),
	DonVi NVARCHAR(20),
	Gia MONEY,
	TonKho VARCHAR(5),
)
GO
INSERT Kho VALUES (1,N'Máy tính T450',N'Máy nhập mới',N'Chiếc',1000,50)
INSERT Kho VALUES (2,N'Điện thoại Nokia5670',N'Điện thoại đang hot',N'Chiếc',200,130)
INSERT Kho VALUES (3,N'Máy in Samsung 450',N'Máy in đang ế',N'Chiếc',100,23)
GO

CREATE TABLE KhachHang
(
	TenKH NVARCHAR(20) PRIMARY KEY,
	DiaChi NVARCHAR(40),
	SDT VARCHAR(12),
)
GO
INSERT KhachHang VALUES (N'Nguyễn Văn An',N'111 Nguyễn Trãi, Thanh Xuân, Hà Nội',987654321)
INSERT KhachHang VALUES (N'Nguyễn Văn B',N'112 Nguyễn Trãi, Thanh Xuân, Hà Nội',987654322)
INSERT KhachHang VALUES (N'Nguyễn Thị C',N'113 Nguyễn Trãi, Thanh Xuân, Hà Nội',987654323)

GO

CREATE TABLE DonHang
(
	MaDH VARCHAR(5) PRIMARY KEY,
	TenKH NVARCHAR(20) FOREIGN KEY REFERENCES KhachHang(TenKH),
	NgayDH DATE
)
GO
INSERT DonHang VALUES (123,N'Nguyễn Văn An','20091118')
INSERT DonHang VALUES (124,N'Nguyễn Văn B','20091122')
GO

CREATE TABLE ChiTietDH
(
	MaDH VARCHAR(5) FOREIGN KEY REFERENCES DonHang(MaDH),
	MaSP VARCHAR(5) FOREIGN KEY REFERENCES Kho(ID_SP),
	TenSP NVARCHAR(40),
	Gia MONEY,
	SL INT
)
GO
INSERT ChiTietDH VALUES (123,1,N'Máy tính T450',1000,1)
INSERT ChiTietDH VALUES (123,2,N'Điện thoại Nokia5670',200,2)
INSERT ChiTietDH VALUES (123,3,N'Máy in Samsung 450',100,1)

INSERT ChiTietDH VALUES (124,1,N'Máy tính T450',1000,2)
INSERT ChiTietDH VALUES (124,2,N'Điện thoại Nokia5670',200,2)
INSERT ChiTietDH VALUES (124,3,N'Máy in Samsung 450',100,1)
GO
DELETE Kho
DELETE ChiTietDH
--2
SELECT DH.MaDH, KH.*, DH.NgayDH 
FROM DonHang AS DH, KhachHang AS KH

SELECT K.TenSP, K.MoTa, K.DonVi, K.Gia, CT.SL, K.Gia * CT.SL AS ThanhTien
FROM Kho AS K, ChiTietDH AS CT 
WHERE K.TenSP = CT.TenSP AND K.ID_SP = CT.MaSP AND MaDH = 124
--4
----A
SELECT KH.* FROM KhachHang AS KH, DonHang AS DH
WHERE KH.TenKH = DH.TenKH AND DH.MaDH > 0
----B
SELECT * FROM Kho
----C
SELECT * FROM DonHang

--5
----A
SELECT * FROM KhachHang
WHERE TenKH >= N'A%' AND TenKH <= N'Z%'
----B
SELECT * FROM Kho
ORDER BY Gia DESC
----C
SELECT * FROM DonHang
WHERE TenKH = N'Nguyễn Văn An'

--6
----A
SELECT COUNT(*) AS N'SL KH đã mua' FROM DonHang AS DH, KhachHang AS KH
WHERE DH.TenKH = KH.TenKH
----B
SELECT COUNT(*) FROM Kho
----C
SELECT Sum(Gia * SL) FROM ChiTietDH
WHERE MaDH = 123

DROP TABLE Kho
DROP TABLE KhachHang
DROP TABLE DonHang
DROP TABLE ChiTietDH